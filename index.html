<!DOCTYPE html>
<html lang="en" class="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Web Scanner | Login & Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Enable dark mode by class strategy
    tailwind.config = {
      darkMode: 'class'
    };
  </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex flex-col min-h-screen transition-colors duration-300">

  <!-- Theme Toggle Button -->
  <div class="absolute top-4 right-4">
    <button id="theme-toggle" class="p-2 rounded-full bg-white dark:bg-gray-800 shadow hover:scale-105 transition">
      <span id="theme-icon">ðŸŒ™</span>
    </button>
  </div>

  <!-- Main Content Wrapper -->
  <main class="flex-grow flex items-center justify-center px-4 py-8">
    <div id="container" class="w-full max-w-md p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md">
      <h2 id="form-title" class="text-2xl font-semibold text-center text-gray-700 dark:text-gray-100 mb-4">Login</h2>

      <form id="auth-form" class="space-y-4">
        <div id="name-field" class="hidden">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Name</label>
          <input type="text" id="name" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring focus:ring-indigo-200 dark:bg-gray-700 dark:text-white">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
          <input type="email" id="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring focus:ring-indigo-200 dark:bg-gray-700 dark:text-white" required>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
          <input type="password" id="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring focus:ring-indigo-200 dark:bg-gray-700 dark:text-white" required>
        </div>

        <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700">Login</button>
      </form>

      <p class="mt-4 text-sm text-center text-gray-600 dark:text-gray-400">
        Don't have an account? <a href="#" id="toggle-form" class="text-indigo-600 hover:underline">Register</a>
      </p>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white dark:bg-gray-800 shadow-inner py-4">
    <div class="max-w-7xl mx-auto px-4 text-center text-sm text-gray-500 dark:text-gray-400">
      &copy; 2025 Web Security Scanner. Developed by Atul Kumar Pandey ðŸ’»
    </div>
  </footer>

  <!-- Script: Theme Toggle + Auth -->
  <script>
    // ðŸŒ™ Dark Mode Toggle Logic
    const htmlEl = document.documentElement;
    const toggleBtn = document.getElementById("theme-toggle");
    const icon = document.getElementById("theme-icon");

    const setTheme = (theme) => {
      if (theme === "dark") {
        htmlEl.classList.add("dark");
        localStorage.setItem("theme", "dark");
        icon.textContent = "â˜€ï¸";
      } else {
        htmlEl.classList.remove("dark");
        localStorage.setItem("theme", "light");
        icon.textContent = "ðŸŒ™";
      }
    };

    // Load theme on page load
    const storedTheme = localStorage.getItem("theme");
    if (storedTheme) setTheme(storedTheme);
    else if (window.matchMedia("(prefers-color-scheme: dark)").matches) setTheme("dark");

    toggleBtn.addEventListener("click", () => {
      const isDark = htmlEl.classList.contains("dark");
      setTheme(isDark ? "light" : "dark");
    });

    // ðŸ’¡ Login/Register Logic
    document.addEventListener("DOMContentLoaded", function () {
      const authForm = document.getElementById("auth-form");
      const formTitle = document.getElementById("form-title");
      const nameField = document.getElementById("name-field");
      const toggleFormLink = document.getElementById("toggle-form");
      let isLogin = true;

      toggleFormLink.addEventListener("click", function (event) {
        event.preventDefault();
        isLogin = !isLogin;

        if (isLogin) {
          formTitle.textContent = "Login";
          nameField.classList.add("hidden");
          toggleFormLink.textContent = "Register";
          authForm.querySelector("button").textContent = "Login";
        } else {
          formTitle.textContent = "Register";
          nameField.classList.remove("hidden");
          toggleFormLink.textContent = "Login";
          authForm.querySelector("button").textContent = "Register";
        }
      });

      authForm.addEventListener("submit", async function (event) {
        event.preventDefault();

        const name = isLogin ? "" : document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const endpoint = isLogin ? "/api/login" : "/api/register";
        const apiUrl = "http://127.0.0.1:5000" + endpoint;

        try {
          const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, password })
          });

           const data = await response.json();

            // If response is not ok, show error message or fallback
            if (!response.ok) {
              alert(data.message || "Registration/Login failed.");
              return;
            }

            // If everything is good
            alert(data.message || (isLogin ? "Login successful!" : "Registration successful!"));

            if (isLogin) {
              localStorage.setItem("token", data.token);
              window.location.href = "home.html";
            }

          

          if (response.ok && isLogin) {
            localStorage.setItem("token", data.token);
            window.location.href = "home.html";
          }
        } catch (error) {
          console.error("Error:", error);
          alert("Something went wrong! Please try again.");
        }
      });
    });
  </script>

</body>
</html>
