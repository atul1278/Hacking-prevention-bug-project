<!DOCTYPE html>
<html lang="en" class="transition-colors duration-500">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Web Scanner - Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"/>

  <style>
    .severity-high { background-color: #fee2e2; color: #b91c1c; }
    .severity-medium { background-color: #fef3c7; color: #b45309; }
    .severity-low { background-color: #d1fae5; color: #065f46; }

    .card-animate {
      animation: fadeInUp 0.4s ease forwards;
      opacity: 0;
      transform: translateY(10px);
    }

    @keyframes fadeInUp {
      to { opacity: 1; transform: translateY(0); }
    }

    .pulse-button {
      animation: pulse 1.2s infinite ease-in-out;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .fade-section {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-white transition-colors duration-500">

  <!-- Navbar -->
  <nav class="bg-indigo-600 p-4 shadow-md dark:bg-indigo-800">
    <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
      <a href="home.html" class="text-white text-xl font-bold">Web Scanner</a>
      <ul class="flex flex-wrap items-center justify-center gap-3">
        <li><a href="demo.html" class="text-white hover:underline">Demo</a></li>
        <li><a href="docs.html" class="text-white hover:underline">Docs</a></li>
        <li><a href="features.html" class="text-white hover:underline">Features</a></li>
        <li><a href="contact.html" class="text-white hover:underline">Contact</a></li>
        <li>
          <button id="theme-toggle" class="text-white text-xl transition duration-200 ease-in-out">üåô</button>
        </li>
        <li>
          <button id="logout" class="bg-red-500 hover:bg-red-700 text-white font-bold px-3 py-1 rounded">Logout</button>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Scanner Section -->
  <main class="flex items-center justify-center min-h-[80vh] p-4">
    <section class="w-full max-w-2xl p-6 bg-white dark:bg-gray-800 rounded-lg shadow-xl transition-all duration-300">
      <h2 class="text-3xl font-bold text-center mb-6">Web Security Scanner</h2>
      <form id="scan-form" class="space-y-4" novalidate>
        <label for="website-url" class="block text-sm font-medium">Target URL:</label>
        <input
          type="url"
          id="website-url"
          placeholder="https://example.com"
          required
          class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-indigo-400 dark:bg-gray-700 dark:border-gray-600"
        />
        <button
          type="submit"
          id="scan-btn"
          class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-md font-semibold"
        >
          üîç Scan Website
        </button>
      </form>

      <!-- Loading Spinner -->
      <div id="loading-spinner" class="flex justify-center my-4 hidden">
        <div class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
      </div>

      <!-- Results -->
      <div id="scan-results" class="mt-6 space-y-4 hidden fade-section">
        <h3 class="text-xl font-semibold">Scan Results:</h3>
        <div id="results-container" class="space-y-3"></div>
        <button
          id="export-csv"
          class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-md hidden"
        >
          üìÑ Export to CSV
        </button>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-indigo-600 text-white text-center py-4 dark:bg-indigo-800">
    <p>&copy; 2025 Web Scanner | Built with ‚ù§Ô∏è by Atul Kumar Pandey</p>
  </footer>

  <!-- Scripts -->
  <script>
    // Dark mode toggle
    const toggleButton = document.getElementById("theme-toggle");
    const prefersDark = localStorage.getItem("theme") === "dark";

    if (prefersDark) {
      document.documentElement.classList.add("dark");
      toggleButton.textContent = "‚òÄÔ∏è";
    }

    toggleButton.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      const isDark = document.documentElement.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      toggleButton.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
    });

    // Redirect if not logged in
    if (!localStorage.getItem("token")) {
      window.location.href = "index.html";
    }

    const form = document.getElementById("scan-form");
    const urlInput = document.getElementById("website-url");
    const spinner = document.getElementById("loading-spinner");
    const scanResults = document.getElementById("scan-results");
    const resultsContainer = document.getElementById("results-container");
    const exportCsvButton = document.getElementById("export-csv");
    const scanBtn = document.getElementById("scan-btn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const url = urlInput.value.trim();

      if (!url) {
        Toastify({
          text: "Please enter a valid URL.",
          backgroundColor: "#F87171",
          duration: 3000
        }).showToast();
        return;
      }

      resultsContainer.innerHTML = "";
      scanResults.classList.add("hidden");
      spinner.classList.remove("hidden");
      scanBtn.classList.add("pulse-button");

      try {
        const res = await fetch("http://127.0.0.1:5000/api/scan", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${localStorage.getItem("token")}`
          },
          body: JSON.stringify({ url })
        });

        const data = await res.json();
        spinner.classList.add("hidden");
        scanBtn.classList.remove("pulse-button");
        scanResults.classList.remove("hidden");

        if (res.ok && data.vulnerabilities?.length > 0) {
          data.vulnerabilities.forEach(vul => {
            const severityClass =
              vul.severity === "High" ? "severity-high" :
              vul.severity === "Medium" ? "severity-medium" : "severity-low";

            resultsContainer.innerHTML += `
              <div class="p-4 rounded-md ${severityClass} card-animate">
                <h4 class="font-bold text-lg">${vul.title}</h4>
                <p>${vul.description}</p>
                <p class="text-sm">Type: ${vul.type}</p>
                <p class="text-sm">Attacker IP: ${vul.attacker || "Unknown"}</p>
                <span class="text-xs font-semibold">${vul.severity} Severity</span>
              </div>`;
          });

          exportCsvButton.classList.remove("hidden");
          Toastify({
            text: "Vulnerabilities detected!",
            backgroundColor: "#FB923C",
            duration: 4000
            3
          }).showToast();
        } else {
          resultsContainer.innerHTML = `<p class="text-green-700 dark:text-green-400">No vulnerabilities found. ‚úÖ</p>`;
          Toastify({
            text: "Site is clean!",
            backgroundColor: "#10B981",
            duration: 3000
          }).showToast();
        }
      } catch (err) {
        spinner.classList.add("hidden");
        scanBtn.classList.remove("pulse-button");
        Toastify({
          text: "Scan failed: " + err.message,
          backgroundColor: "#EF4444",
          duration: 3000
        }).showToast();
      }
    });

    exportCsvButton.addEventListener("click", async () => {
      try {
        const res = await fetch("http://127.0.0.1:5000/api/export/csv", {
          headers: { "Authorization": `Bearer ${localStorage.getItem("token")}` }
        });

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "scan_results.csv";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      } catch (err) {
        Toastify({
          text: "Export failed: " + err.message,
          backgroundColor: "#DC2626",
          duration: 3000
        }).showToast();
      }
    });

    document.getElementById("logout").addEventListener("click", () => {
      localStorage.removeItem("token");
      window.location.href = "index.html";
    });
  </script>
</body>
</html>
